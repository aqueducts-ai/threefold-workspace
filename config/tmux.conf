# LLM Workspace tmux configuration
# https://github.com/threefold/threefold-workspace
#
# A clean, productivity-focused tmux setup for AI-assisted development

# ============================================================================
# CORE SETTINGS
# ============================================================================

# Enable mouse support for easy pane switching
set -g mouse on

# Set default terminal for proper color support
set -g default-terminal "screen-256color"

# Start windows and panes at 1, not 0 (easier keyboard access)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# No delay for escape key
set -sg escape-time 0

# Generous scrollback history
set -g history-limit 50000

# Update status/pane titles periodically
set -g status-interval 5

# ============================================================================
# COPY MODE (Vi-style with clipboard integration)
# ============================================================================

# Use vi mode for copy mode
setw -g mode-keys vi

# Setup 'v' to begin selection as in Vim
bind-key -T copy-mode-vi v send-keys -X begin-selection

# Platform-specific clipboard integration
# macOS uses pbcopy, Linux uses xclip
if-shell "uname | grep -q Darwin" \
  "bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'" \
  "bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard'"

# Enter key also copies
unbind -T copy-mode-vi Enter
if-shell "uname | grep -q Darwin" \
  "bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'pbcopy'" \
  "bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard'"

# Mouse drag copies to clipboard
if-shell "uname | grep -q Darwin" \
  "bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'pbcopy'" \
  "bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard'"

# Double/triple click selection
if-shell "uname | grep -q Darwin" \
  "bind-key -T copy-mode-vi DoubleClick1Pane select-pane \\; send-keys -X select-word \\; send-keys -X copy-pipe-no-clear 'pbcopy'" \
  "bind-key -T copy-mode-vi DoubleClick1Pane select-pane \\; send-keys -X select-word \\; send-keys -X copy-pipe-no-clear 'xclip -selection clipboard'"

if-shell "uname | grep -q Darwin" \
  "bind-key -T copy-mode-vi TripleClick1Pane select-pane \\; send-keys -X select-line \\; send-keys -X copy-pipe-no-clear 'pbcopy'" \
  "bind-key -T copy-mode-vi TripleClick1Pane select-pane \\; send-keys -X select-line \\; send-keys -X copy-pipe-no-clear 'xclip -selection clipboard'"

# Right click to paste
if-shell "uname | grep -q Darwin" \
  "bind-key -n MouseDown2Pane run \"tmux set-buffer \\\"\\$(pbpaste)\\\"; tmux paste-buffer\"" \
  "bind-key -n MouseDown2Pane run \"tmux set-buffer \\\"\\$(xclip -o -selection clipboard)\\\"; tmux paste-buffer\""

# Convenient copy mode entry with Ctrl+Space
bind-key -n C-Space copy-mode

# ============================================================================
# STATUS BAR
# ============================================================================

# Position at top
set-option -g status-position top

# Colors
set -g status-bg colour234
set -g status-fg colour231

# Left status - branding
set -g status-left-length 70
set -g status-left '#[fg=colour46,bold]  LLM  #[fg=colour39]|#[fg=colour231,bold] WORKSPACE #[fg=colour39]|#[default] '

# Right status - session info and time
set -g status-right-length 60
set -g status-right ' #[fg=colour39]|#[fg=colour245] Session: #S #[fg=colour39]|#[fg=colour46] %H:%M #[fg=colour39]|#[fg=colour46,bold]  LLM  #[default]'

# Center window list
set -g status-justify centre

# Window status format
setw -g window-status-format '#[fg=colour245] #I:#W '
setw -g window-status-current-format '#[fg=colour46,bold] #I:#W '

# ============================================================================
# PANE BORDERS
# ============================================================================

# Border colors
set -g pane-border-style 'fg=colour238'
set -g pane-active-border-style 'fg=colour39'

# Show pane titles in borders
set -g pane-border-status top
set -g pane-border-format '#[bg=colour233]#[fg=colour39,bold]#{?pane_active, > , | }#[fg=colour46,bold] #{pane_title} #[fg=colour208,bold]#{@llm_status}'

# Auto-rename panes based on current path
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# ============================================================================
# KEY BINDINGS
# ============================================================================

# Better split commands (match vim)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with Vim keys (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Open GitHub PR for current branch (prefix + g)
bind-key g run-shell "gh pr view --web 2>/dev/null || gh pr create --web"

# ============================================================================
# OPTIONAL: Provider-specific settings can source additional configs
# ============================================================================
# Example: source-file ~/.config/llm-workspace/provider.tmux.conf
